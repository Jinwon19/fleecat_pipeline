# FleeCat í¬ë¡¤ë§ & ë°ì´í„° íŒŒì´í”„ë¼ì¸ ğŸ•·ï¸

> í”Œë¦¬ë§ˆì¼“ ì •ë³´ ì›¹í¬ë¡¤ë§ â†’ LLM ë°ì´í„° ì •ì œ â†’ Supabase DB ì €ì¥ ìë™í™” íŒŒì´í”„ë¼ì¸

ë¹„ì •í˜• í”Œë¦¬ë§ˆì¼“ ì •ë³´ë¥¼ ì›¹ì‚¬ì´íŠ¸ì—ì„œ ìë™ìœ¼ë¡œ ìˆ˜ì§‘í•˜ê³ , **GPT-4ë¥¼ í™œìš©í•´ êµ¬ì¡°í™”ëœ ë°ì´í„°ë¡œ ë³€í™˜**í•˜ì—¬ Supabase PostgreSQLì— ì €ì¥í•˜ëŠ” Python íŒŒì´í”„ë¼ì¸ì…ë‹ˆë‹¤.

---

## ğŸŒŸ í•µì‹¬ ê¸°ëŠ¥

### 1. ë³‘ë ¬ ì›¹í¬ë¡¤ë§
- **Requests (ë¹ ë¦„) â†’ Selenium (JS ë Œë”ë§)** ìë™ í´ë°±
- **ThreadPoolExecutor**ë¡œ ìµœëŒ€ 10ê°œ ë™ì‹œ ì²˜ë¦¬
- ìë™ ì¬ì‹œë„ (ìµœëŒ€ 3íšŒ) + ì§„í–‰ë¥  í‘œì‹œ (tqdm)

### 2. LLM ë°ì´í„° ì •ì œ
- **GPT-4o-mini**ë¡œ ë¹„ì •í˜• í…ìŠ¤íŠ¸ â†’ JSON êµ¬ì¡°í™”
- **Vision API**ë¡œ í¬ìŠ¤í„° ì´ë¯¸ì§€ì—ì„œ ì •ë³´ ì¶”ì¶œ
- 3ë‹¨ê³„ ê²€ì¦ í”„ë¡œì„¸ìŠ¤ (í…ìŠ¤íŠ¸ â†’ ì´ë¯¸ì§€ â†’ ê²€ì¦)

### 3. Supabase DB ì—°ë™
- PostgreSQL í´ë¼ìš°ë“œ DBì— ìë™ ì €ì¥
- ì¤‘ë³µ ì²´í¬ ë° ì¦ë¶„ ì—…ë°ì´íŠ¸
- ì§€ì˜¤ì½”ë”© (ì£¼ì†Œ â†’ ì¢Œí‘œ ë³€í™˜)

### 4. í†µí•© íŒŒì´í”„ë¼ì¸
- **master_pipeline.py** í•˜ë‚˜ë¡œ ì „ì²´ ìë™í™”
- ë‹¨ê³„ë³„ ì‹¤í–‰ ê°€ëŠ¥ (ë””ë²„ê¹… ìš©ì´)
- ì‹¤í–‰ ë¦¬í¬íŠ¸ ìë™ ìƒì„±

---

## ğŸ› ï¸ ê¸°ìˆ  ìŠ¤íƒ

- **Python**: 3.10+
- **Web Scraping**: Selenium, BeautifulSoup4, Requests
- **LLM**: OpenAI GPT-4o-mini, GPT-4 Vision
- **Database**: Supabase Python Client, SQLite3
- **Parallel**: ThreadPoolExecutor (10 workers)
- **Progress**: tqdm

---

## ğŸ“‚ íŒŒì¼ êµ¬ì¡°

```
flee/
â”œâ”€â”€ flea_list_fast.py          # ê²Œì‹œë¬¼ ëª©ë¡ í¬ë¡¤ë§ (ë³‘ë ¬)
â”œâ”€â”€ flea_text_fast.py          # ìƒì„¸ ë‚´ìš© í¬ë¡¤ë§ (ë³‘ë ¬)
â”œâ”€â”€ llm_processor.py           # LLM ë°ì´í„° ì •ì œ ì—”ì§„
â”œâ”€â”€ prompt_templates.py        # GPT í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿
â”œâ”€â”€ supabase_manager.py        # Supabase DB ì—°ë™
â”œâ”€â”€ add_geocoding.py           # Kakao API ì§€ì˜¤ì½”ë”©
â”œâ”€â”€ master_pipeline.py         # ğŸš€ í†µí•© íŒŒì´í”„ë¼ì¸
â”œâ”€â”€ extract_to_json.py         # LLM ì •ì œ ë˜í¼
â”œâ”€â”€ structured_to_db.py        # ë¡œì»¬ SQLite DB ì €ì¥
â”œâ”€â”€ requirements.txt           # Python ì˜ì¡´ì„±
â””â”€â”€ .env.example               # í™˜ê²½ ë³€ìˆ˜ ì˜ˆì‹œ
```

---

## ğŸš€ ë¹ ë¥¸ ì‹œì‘

### 1. í™˜ê²½ ì„¤ì •

```bash
# ê°€ìƒí™˜ê²½ ìƒì„±
python -m venv venv

# í™œì„±í™” (Windows)
venv\Scripts\activate

# í™œì„±í™” (Mac/Linux)
source venv/bin/activate

# ì˜ì¡´ì„± ì„¤ì¹˜
pip install -r requirements.txt
```

### 2. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

`.env.example`ì„ ë³µì‚¬í•˜ì—¬ `.env` ìƒì„±:

```bash
cp .env.example .env
```

`.env` íŒŒì¼ì— ë‹¤ìŒ ì •ë³´ ì…ë ¥:

```env
# OpenAI API
OPENAI_API_KEY=sk-your-openai-api-key-here

# Supabase
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_KEY=your-supabase-service-role-key

# Kakao Maps (ì§€ì˜¤ì½”ë”©ìš©)
KAKAO_REST_API_KEY=your-kakao-rest-api-key
```

### 3. ì „ì²´ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰

```bash
python master_pipeline.py
```

ì´ ëª…ë ¹ì–´ í•˜ë‚˜ë¡œ:
1. âœ… ì›¹ì‚¬ì´íŠ¸ í¬ë¡¤ë§
2. âœ… LLM ë°ì´í„° ì •ì œ
3. âœ… ë¡œì»¬ DB ì €ì¥
4. âœ… Supabase ì—…ë¡œë“œ

ëª¨ë“  ê³¼ì •ì´ ìë™ ì‹¤í–‰ë©ë‹ˆë‹¤!

---

## ğŸ“‹ ë‹¨ê³„ë³„ ì‹¤í–‰

ì „ì²´ íŒŒì´í”„ë¼ì¸ ëŒ€ì‹  ê°œë³„ ë‹¨ê³„ë§Œ ì‹¤í–‰í•˜ê³  ì‹¶ì„ ë•Œ:

### Step 1: ê²Œì‹œë¬¼ ëª©ë¡ í¬ë¡¤ë§

```bash
python flea_list_fast.py
```

**ê²°ê³¼**: `fleamarket_posts.json` (ì œëª©, ë§í¬, ì´ë¯¸ì§€ URL)

### Step 2: ìƒì„¸ ë‚´ìš© í¬ë¡¤ë§

```bash
python flea_text_fast.py
```

**ê²°ê³¼**: `fleamarket_detail.json` (ë³¸ë¬¸, ë‚ ì§œ, ì¥ì†Œ)

### Step 3: LLM ë°ì´í„° ì •ì œ

```bash
python extract_to_json.py
```

**ê²°ê³¼**: `fleamarket_structured.json` (êµ¬ì¡°í™”ëœ JSON)

### Step 4: Supabase ì €ì¥

```bash
python supabase_manager.py
```

**ê²°ê³¼**: Supabase `markets`, `sessions` í…Œì´ë¸”ì— ì €ì¥

### Step 5: ì§€ì˜¤ì½”ë”© (ì„ íƒ)

```bash
python add_geocoding.py
```

**ê²°ê³¼**: ì£¼ì†Œ â†’ ì¢Œí‘œ ë³€í™˜ (Kakao API)

---

## âš™ï¸ ê³ ê¸‰ ì˜µì…˜

### í¬ë¡¤ë§ë§Œ ë‹¤ì‹œ ì‹¤í–‰ (LLM ê±´ë„ˆë›°ê¸°)

```bash
python master_pipeline.py --skip-llm
```

### LLM ì •ì œë§Œ ë‹¤ì‹œ ì‹¤í–‰ (í¬ë¡¤ë§ ê±´ë„ˆë›°ê¸°)

```bash
python master_pipeline.py --skip-crawling
```

### ì „ì²´ ì¬ì²˜ë¦¬ (ê¸°ì¡´ ë°ì´í„° ë®ì–´ì“°ê¸°)

```bash
python master_pipeline.py --force
```

---

## ğŸ”§ ì„¤ì • ì»¤ìŠ¤í„°ë§ˆì´ì§•

### í¬ë¡¤ë§ í˜ì´ì§€ ìˆ˜ ì¡°ì •

**`flea_list_fast.py`** íŒŒì¼ ìˆ˜ì •:

```python
MAX_PAGES = 10     # 10í˜ì´ì§€ë§Œ í¬ë¡¤ë§
MAX_WORKERS = 5    # 5ê°œ ë™ì‹œ ì²˜ë¦¬
```

### LLM ëª¨ë¸ ë³€ê²½

**`llm_processor.py`** íŒŒì¼ ìˆ˜ì •:

```python
model="gpt-4o-mini"  # ë¹ ë¥´ê³  ì €ë ´ (ì¶”ì²œ)
# model="gpt-4o"     # ëŠë¦¬ì§€ë§Œ ì •í™•
```

---

## ğŸ“Š ë°ì´í„° í”Œë¡œìš°

```
ì›¹ì‚¬ì´íŠ¸ (í”Œë¦¬ë§ˆì¼“ ê²Œì‹œê¸€)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  flea_list_fast.py (ë³‘ë ¬ 10 workers)â”‚
â”‚  - Requests â†’ Selenium í´ë°±         â”‚
â”‚  - ê²Œì‹œë¬¼ ëª©ë¡ ìˆ˜ì§‘                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ fleamarket_posts.json
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  flea_text_fast.py (ë³‘ë ¬ ì²˜ë¦¬)      â”‚
â”‚  - ìƒì„¸ ë³¸ë¬¸ í¬ë¡¤ë§                  â”‚
â”‚  - 200ì ì´ìƒë§Œ ì €ì¥                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ fleamarket_detail.json
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  llm_processor.py (GPT-4o)          â”‚
â”‚  - 3ë‹¨ê³„ ì •ì œ í”„ë¡œì„¸ìŠ¤               â”‚
â”‚    1) í…ìŠ¤íŠ¸ ë¶„ì„                    â”‚
â”‚    2) ì´ë¯¸ì§€ ë¶„ì„ (Vision API)       â”‚
â”‚    3) ë°ì´í„° ê²€ì¦                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ fleamarket_structured.json
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  supabase_manager.py                â”‚
â”‚  - Supabase PostgreSQL ì €ì¥         â”‚
â”‚  - ì¤‘ë³µ ì²´í¬ ë° ì—…ë°ì´íŠ¸             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
Supabase DB (markets, sessions í…Œì´ë¸”)
```

---

## ğŸ¯ 3ë‹¨ê³„ LLM ì •ì œ í”„ë¡œì„¸ìŠ¤

### 1ë‹¨ê³„: í…ìŠ¤íŠ¸ ë¶„ì„
```python
# ê²Œì‹œê¸€ ë³¸ë¬¸ì—ì„œ ì •ë³´ ì¶”ì¶œ
{
  "market_name": "ì„œìš¸ìˆ² í”Œë¦¬ë§ˆì¼“",
  "place": "ì„œìš¸ìˆ²",
  "sessions": [{
    "start_date": "2024-10-20",
    "start_time": "14:00",
    "end_time": "18:00"
  }]
}
```

### 2ë‹¨ê³„: ì´ë¯¸ì§€ ë¶„ì„ (Vision API)
- í¬ìŠ¤í„° ì´ë¯¸ì§€ì—ì„œ ëˆ„ë½ëœ ì •ë³´ ì¶”ì¶œ
- ë‚ ì§œ, ì‹œê°„, ì¥ì†Œ ì •ë³´ ë³´ì™„

### 3ë‹¨ê³„: ë°ì´í„° ê²€ì¦
- ë‚ ì§œ í˜•ì‹ í†µì¼ (YYYY-MM-DD)
- "ë¯¸ì •" ê°’ ì œê±°
- í•„ìˆ˜ í•„ë“œ ê²€ì¦

---

## ğŸ“ˆ ì„±ëŠ¥ ìµœì í™”

### ë³‘ë ¬ ì²˜ë¦¬
```python
with ThreadPoolExecutor(max_workers=10) as executor:
    futures = {executor.submit(fetch_page, page): page
               for page in range(1, MAX_PAGES + 1)}
```

**ê²°ê³¼**: ë‹¨ì¼ ì²˜ë¦¬ ëŒ€ë¹„ **10ë°° ë¹ ë¥¸ í¬ë¡¤ë§**

### í•˜ì´ë¸Œë¦¬ë“œ í¬ë¡¤ë§
```python
# 1. Requestsë¡œ ë¹ ë¥´ê²Œ ì‹œë„
response = requests.get(url, timeout=10)

# 2. ì‹¤íŒ¨ ì‹œ Seleniumìœ¼ë¡œ í´ë°±
if response.status_code != 200:
    driver = webdriver.Chrome()
    driver.get(url)
```

**ê²°ê³¼**: ì†ë„ì™€ ì•ˆì •ì„± ëª¨ë‘ í™•ë³´

### ì§€ì˜¤ì½”ë”© ìºì‹±
```python
# SQLiteì— ë³€í™˜ ê²°ê³¼ ì €ì¥
if address in cache:
    return cache[address]  # ìºì‹œ ì‚¬ìš©
else:
    coords = kakao_geocode(address)  # API í˜¸ì¶œ
    cache[address] = coords
```

**ê²°ê³¼**: API í˜¸ì¶œ 80% ê°ì†Œ

---

## ğŸ› ë¬¸ì œ í•´ê²°

### ChromeDriver ì˜¤ë¥˜

**ì¦ìƒ**: "chromedriver.exe not found"

**í•´ê²°**:
```bash
# ChromeDriver ìë™ ì„¤ì¹˜
pip install webdriver-manager
```

ë˜ëŠ” ìˆ˜ë™ ë‹¤ìš´ë¡œë“œ: https://chromedriver.chromium.org/

### OpenAI API í‚¤ ì˜¤ë¥˜

**ì¦ìƒ**: "AuthenticationError: Incorrect API key"

**í•´ê²°**:
1. `.env` íŒŒì¼ í™•ì¸
2. OpenAI ëŒ€ì‹œë³´ë“œì—ì„œ API í‚¤ ì¬í™•ì¸
3. í™˜ê²½ ë³€ìˆ˜ ë‹¤ì‹œ ë¡œë“œ

### Supabase ì—°ê²° ì‹¤íŒ¨

**ì¦ìƒ**: "ConnectionError: Unable to connect to Supabase"

**í•´ê²°**:
1. `.env` íŒŒì¼ì˜ URLê³¼ KEY í™•ì¸
2. Supabase í”„ë¡œì íŠ¸ê°€ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
3. í…Œì´ë¸” (`markets`, `sessions`)ì´ ìƒì„±ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸

---

## ğŸ’¡ íŒ & íŠ¸ë¦­

### ë¹„ìš© ì ˆê°
- `gpt-4o-mini` ì‚¬ìš© (gpt-4 ëŒ€ë¹„ 10ë°° ì €ë ´)
- ìºì‹± í™œìš©í•˜ì—¬ ì¤‘ë³µ API í˜¸ì¶œ ë°©ì§€
- ë°°ì¹˜ ì²˜ë¦¬ë¡œ API í˜¸ì¶œ ìµœì†Œí™”

### ë””ë²„ê¹…
```bash
# ë¡œê·¸ íŒŒì¼ í™•ì¸
cat logs/pipeline_*.log

# ì‹¤í–‰ ë¦¬í¬íŠ¸ í™•ì¸
cat summary.txt
```

### ì¦ë¶„ ì—…ë°ì´íŠ¸
```bash
# ì‹ ê·œ ë°ì´í„°ë§Œ ìˆ˜ì§‘ (ê¸°ë³¸ê°’)
python master_pipeline.py

# ì „ì²´ ì¬ì²˜ë¦¬
python master_pipeline.py --force
```

---

## ğŸ“Š ì˜ˆìƒ ì²˜ë¦¬ ì‹œê°„ & ë¹„ìš©

| ì‘ì—… | ë°ì´í„° | ì†Œìš” ì‹œê°„ | ë¹„ìš© |
|------|--------|----------|------|
| í¬ë¡¤ë§ (10í˜ì´ì§€) | 100ê°œ ê²Œì‹œë¬¼ | 20ì´ˆ~2ë¶„ | ë¬´ë£Œ |
| LLM ì •ì œ | 100ê°œ ê²Œì‹œë¬¼ | 2~5ë¶„ | $0.10~0.50 |
| DB ì €ì¥ | 100ê°œ ê²Œì‹œë¬¼ | 10~30ì´ˆ | ë¬´ë£Œ |
| **ì´ê³„** | **100ê°œ** | **3~8ë¶„** | **~$0.50** |

---

## ğŸ”® í–¥í›„ ê°œì„  ê³„íš

- [ ] Playwrightë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ (ë” ë¹ ë¥¸ í¬ë¡¤ë§)
- [ ] Redis ìºì‹± ì¶”ê°€
- [ ] ë¶„ì‚° í¬ë¡¤ë§ (ì—¬ëŸ¬ ë¨¸ì‹ )
- [ ] ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ
- [ ] ì—ëŸ¬ ì•Œë¦¼ (Slack, Email)

---

## ğŸ“ ë¼ì´ì„ ìŠ¤

MIT License

---

## ğŸ‘¥ ê¸°ì—¬

ì´ìŠˆ ë° PR í™˜ì˜í•©ë‹ˆë‹¤!

---

**ê°œë°œ í™˜ê²½**: Python 3.10+, OpenAI API, Supabase
**ë³‘ë ¬ ì²˜ë¦¬**: ThreadPoolExecutor (ìµœëŒ€ 10 workers)
**LLM**: GPT-4o-mini (í…ìŠ¤íŠ¸), GPT-4 Vision (ì´ë¯¸ì§€)
