# ì§€ë„ ì‹œê°í™” ì¢Œí‘œ ë³€í™˜ ê°œì„  í”„ë¡œì íŠ¸ ê³„íšì„œ

## ğŸ“‹ í”„ë¡œì íŠ¸ ê°œìš”

### í˜„ì¬ ë¬¸ì œì 
- ë°±ì—”ë“œ DB â†’ í”„ë¡ íŠ¸ì—”ë“œ(ì¹´ì¹´ì˜¤ë§µ)ë¡œ ë°ì´í„° ì „ì†¡ ì‹œ ì¥ì†Œëª…, ì§€ì—­ëª…ì˜ ì¢Œí‘œ ë³€í™˜ ì‹¤íŒ¨ìœ¨ì´ ë†’ìŒ
- ì¹´ì¹´ì˜¤ë§µ APIê°€ ê²€ìƒ‰í•˜ì§€ ëª»í•˜ëŠ” ì¥ì†Œëª…, ì§€ì—­ëª… ë‹¤ìˆ˜ ì¡´ì¬

### í•´ê²° ë°©ì•ˆ
ë°±ì—”ë“œì—ì„œ **3ë‹¨ê³„ ì²˜ë¦¬ ì‹œìŠ¤í…œ** êµ¬ì¶•
1. 1ì°¨: ì¹´ì¹´ì˜¤ APIë¡œ ì£¼ì†Œ â†’ ì¢Œí‘œ ë³€í™˜ ì‹œë„
2. 2ì°¨: ì‹¤íŒ¨ ì‹œ ì¥ì†Œëª…/ì§€ì—­ëª…ìœ¼ë¡œ ì¬ì‹œë„
3. 3ì°¨: ì—¬ì „íˆ ì‹¤íŒ¨ ì‹œ AIë¡œ ì£¼ì†Œ ë³´ì • í›„ ì¬ì‹œë„

### í•µì‹¬ ì›ì¹™
- âœ… **ë°±ì—”ë“œì—ì„œ ëª¨ë“  ì²˜ë¦¬ ì™„ë£Œ** â†’ í”„ë¡ íŠ¸ì—”ë“œëŠ” ì™„ì„±ëœ ì¢Œí‘œë§Œ ë°›ìŒ
- âœ… **ì‹¤íŒ¨í•œ ì¼€ì´ìŠ¤ë§Œ AI ì‚¬ìš©** â†’ ë¹„ìš© ìµœì í™”
- âœ… **ì„±ê³µí•œ ê²°ê³¼ëŠ” DB ì €ì¥** â†’ ì¤‘ë³µ ì²˜ë¦¬ ë°©ì§€

---

## ğŸ¯ í”„ë¡œì íŠ¸ ëª©í‘œ

| ëª©í‘œ | í˜„ì¬ | ëª©í‘œ |
|------|------|------|
| ì¢Œí‘œ ë³€í™˜ ì„±ê³µë¥  | ~60-70% | 95% ì´ìƒ |
| API ì‘ë‹µ ì†ë„ | ëŠë¦¼ | 2ì´ˆ ì´ë‚´ |
| AI ì‚¬ìš© ë¹„ìœ¨ | - | ì „ì²´ì˜ 5-10%ë§Œ |
| ì¬ì²˜ë¦¬ í•„ìš”ì„± | ë§¤ë²ˆ | ìµœì´ˆ 1íšŒë§Œ |

---

## ğŸ“Š ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ë°±ì—”ë“œ ì²˜ë¦¬                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  [DB ì¡°íšŒ]                                                    â”‚
â”‚      â†“                                                        â”‚
â”‚  ì¢Œí‘œ ìˆìŒ? â”€â”€YESâ†’ [ì¦‰ì‹œ ë°˜í™˜]                                â”‚
â”‚      â†“ NO                                                     â”‚
â”‚  [1ì°¨: ì¹´ì¹´ì˜¤ API - ì£¼ì†Œë¡œ ê²€ìƒ‰]                              â”‚
â”‚      â†“ ì‹¤íŒ¨                                                   â”‚
â”‚  [2ì°¨: ì¹´ì¹´ì˜¤ API - ì¥ì†Œëª…ìœ¼ë¡œ ê²€ìƒ‰]                          â”‚
â”‚      â†“ ì‹¤íŒ¨                                                   â”‚
â”‚  [3ì°¨: AI ì£¼ì†Œ ë³´ì •]                                          â”‚
â”‚      â†“                                                        â”‚
â”‚  [ì¹´ì¹´ì˜¤ API - ë³´ì •ëœ ì£¼ì†Œë¡œ ê²€ìƒ‰]                            â”‚
â”‚      â†“                                                        â”‚
â”‚  [ì„±ê³µí•œ ì¢Œí‘œë¥¼ DBì— ì €ì¥]                                    â”‚
â”‚      â†“                                                        â”‚
â”‚  [ì™„ì„±ëœ ë°ì´í„° ë°˜í™˜]                                         â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      í”„ë¡ íŠ¸ì—”ë“œ ì²˜ë¦¬                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  [API í˜¸ì¶œ: /api/locations]                                   â”‚
â”‚      â†“                                                        â”‚
â”‚  [ì¢Œí‘œ ë°ì´í„° ìˆ˜ì‹ ]                                           â”‚
â”‚      â†“                                                        â”‚
â”‚  [ì¹´ì¹´ì˜¤ë§µì— ë§ˆì»¤ í‘œì‹œ]                                       â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—“ï¸ ë‹¨ê³„ë³„ ì‹¤í–‰ ê³„íš

### **Phase 1: ë°ì´í„°ë² ì´ìŠ¤ ì¤€ë¹„** (1ì¼)

#### ì‘ì—… ë‚´ìš©
DB í…Œì´ë¸”ì— ì¢Œí‘œ ì €ì¥ ì»¬ëŸ¼ ì¶”ê°€

#### ì‹¤í–‰ SQL
```sql
-- locations í…Œì´ë¸”ì— ì»¬ëŸ¼ ì¶”ê°€
ALTER TABLE locations 
ADD COLUMN latitude DECIMAL(10, 8),
ADD COLUMN longitude DECIMAL(11, 8),
ADD COLUMN geocoded_at TIMESTAMP,
ADD COLUMN geocode_status VARCHAR(20) DEFAULT 'pending';
-- 'pending', 'success', 'failed'

-- ì¸ë±ìŠ¤ ì¶”ê°€ (ì„±ëŠ¥ í–¥ìƒ)
CREATE INDEX idx_geocode_status ON locations(geocode_status);
```

#### ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] DB ë°±ì—… ì™„ë£Œ
- [ ] ì»¬ëŸ¼ ì¶”ê°€ ì‹¤í–‰
- [ ] ê¸°ì¡´ ë°ì´í„° í™•ì¸

---

### **Phase 2: ë°±ì—”ë“œ API êµ¬í˜„** (2-3ì¼)

#### 2-1. í™˜ê²½ ì„¤ì •

**í•„ìš”í•œ íŒ¨í‚¤ì§€ ì„¤ì¹˜**
```bash
npm install node-fetch dotenv
```

**í™˜ê²½ ë³€ìˆ˜ ì„¤ì • (.env)**
```env
KAKAO_API_KEY=your_kakao_rest_api_key
CLAUDE_API_KEY=your_claude_api_key
DATABASE_URL=your_database_connection_string
```

#### 2-2. ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ì‘ì„±

**íŒŒì¼: `utils/geocode.js`**
```javascript
// ì¹´ì¹´ì˜¤ API í˜¸ì¶œ í•¨ìˆ˜
async function tryKakaoGeocode(query) {
  if (!query || query.trim() === '') return null;
  
  try {
    const response = await fetch(
      `https://dapi.kakao.com/v2/local/search/address.json?query=${encodeURIComponent(query)}`,
      {
        headers: {
          'Authorization': `KakaoAK ${process.env.KAKAO_API_KEY}`
        }
      }
    );
    
    const data = await response.json();
    
    if (data.documents && data.documents.length > 0) {
      return {
        lat: parseFloat(data.documents[0].y),
        lng: parseFloat(data.documents[0].x),
        address: data.documents[0].address_name
      };
    }
    
    // ì£¼ì†Œ ê²€ìƒ‰ ì‹¤íŒ¨ ì‹œ í‚¤ì›Œë“œ ê²€ìƒ‰ ì‹œë„
    const keywordResponse = await fetch(
      `https://dapi.kakao.com/v2/local/search/keyword.json?query=${encodeURIComponent(query)}`,
      {
        headers: {
          'Authorization': `KakaoAK ${process.env.KAKAO_API_KEY}`
        }
      }
    );
    
    const keywordData = await keywordResponse.json();
    
    if (keywordData.documents && keywordData.documents.length > 0) {
      return {
        lat: parseFloat(keywordData.documents[0].y),
        lng: parseFloat(keywordData.documents[0].x),
        address: keywordData.documents[0].address_name
      };
    }
    
    return null;
  } catch (error) {
    console.error('Kakao API error:', error);
    return null;
  }
}

// AI ì£¼ì†Œ ë³´ì • í•¨ìˆ˜
async function aiCorrectAddress(location) {
  try {
    const response = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: {
        'x-api-key': process.env.CLAUDE_API_KEY,
        'anthropic-version': '2023-06-01',
        'content-type': 'application/json'
      },
      body: JSON.stringify({
        model: 'claude-sonnet-4-5-20250929',
        max_tokens: 200,
        messages: [{
          role: 'user',
          content: `ë‹¤ìŒ ì¥ì†Œ ì •ë³´ë¥¼ ë¶„ì„í•˜ì—¬ ì •í™•í•œ í•œêµ­ ì£¼ì†Œë¥¼ ë°˜í™˜í•´ì£¼ì„¸ìš”:

ì¥ì†Œëª…: ${location.placeName || 'ì—†ìŒ'}
ì§€ì—­ëª…: ${location.regionName || 'ì—†ìŒ'}
ì›ë³¸ ì£¼ì†Œ: ${location.address || 'ì—†ìŒ'}

ë°˜ë“œì‹œ ë‹¤ìŒ í˜•ì‹ ì¤‘ í•˜ë‚˜ë¡œë§Œ ë‹µë³€í•˜ì„¸ìš”:
- ë„ë¡œëª…ì£¼ì†Œ (ì˜ˆ: ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123)
- ì§€ë²ˆì£¼ì†Œ (ì˜ˆ: ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ ì—­ì‚¼ë™ 123-45)

ì£¼ì†Œë§Œ ì¶œë ¥í•˜ê³  ë‹¤ë¥¸ ì„¤ëª…ì€ í•˜ì§€ ë§ˆì„¸ìš”.`
        }]
      })
    });
    
    const data = await response.json();
    return data.content[0].text.trim();
  } catch (error) {
    console.error('AI API error:', error);
    return null;
  }
}

// ì „ì²˜ë¦¬ í•¨ìˆ˜
function preprocessQuery(query) {
  if (!query) return '';
  return query
    .replace(/\s+/g, ' ')  // ì—°ì†ëœ ê³µë°±ì„ í•˜ë‚˜ë¡œ
    .replace(/[ï¼-ï¼™]/g, (s) => String.fromCharCode(s.charCodeAt(0) - 0xFEE0))  // ì „ê° ìˆ«ìë¥¼ ë°˜ê°ìœ¼ë¡œ
    .trim();
}

module.exports = {
  tryKakaoGeocode,
  aiCorrectAddress,
  preprocessQuery
};
```

#### 2-3. ë©”ì¸ API ì—”ë“œí¬ì¸íŠ¸ ì‘ì„±

**íŒŒì¼: `routes/locations.js`**
```javascript
const express = require('express');
const router = express.Router();
const { tryKakaoGeocode, aiCorrectAddress, preprocessQuery } = require('../utils/geocode');
const db = require('../db'); // DB ì—°ê²° ëª¨ë“ˆ

// ë‹¨ì¼ location ì²˜ë¦¬ í•¨ìˆ˜
async function processLocation(location) {
  // 1. ì´ë¯¸ ì¢Œí‘œê°€ ìˆìœ¼ë©´ ê·¸ëŒ€ë¡œ ë°˜í™˜
  if (location.latitude && location.longitude) {
    return {
      id: location.id,
      name: location.placeName,
      lat: location.latitude,
      lng: location.longitude,
      address: location.address,
      status: 'cached'
    };
  }
  
  let coords = null;
  let method = '';
  
  // 2. ì£¼ì†Œë¡œ ì‹œë„
  if (location.address) {
    const processedAddress = preprocessQuery(location.address);
    coords = await tryKakaoGeocode(processedAddress);
    if (coords) method = 'address';
  }
  
  // 3. ì¥ì†Œëª…ìœ¼ë¡œ ì‹œë„
  if (!coords && location.placeName) {
    const processedPlace = preprocessQuery(location.placeName);
    coords = await tryKakaoGeocode(processedPlace);
    if (coords) method = 'placeName';
  }
  
  // 4. ì§€ì—­ëª…ìœ¼ë¡œ ì‹œë„
  if (!coords && location.regionName) {
    const processedRegion = preprocessQuery(location.regionName);
    coords = await tryKakaoGeocode(processedRegion);
    if (coords) method = 'regionName';
  }
  
  // 5. AI ë³´ì • ì‹œë„
  if (!coords) {
    console.log(`ğŸ¤– AI ë³´ì • ì‹œì‘: ${location.placeName}`);
    const correctedAddress = await aiCorrectAddress(location);
    
    if (correctedAddress) {
      coords = await tryKakaoGeocode(correctedAddress);
      if (coords) method = 'ai_corrected';
    }
  }
  
  // 6. ê²°ê³¼ DB ì €ì¥
  if (coords) {
    await db.query(
      `UPDATE locations 
       SET latitude = ?, longitude = ?, geocoded_at = NOW(), geocode_status = 'success'
       WHERE id = ?`,
      [coords.lat, coords.lng, location.id]
    );
    
    console.log(`âœ… ì„±ê³µ (${method}): ${location.placeName} â†’ (${coords.lat}, ${coords.lng})`);
    
    return {
      id: location.id,
      name: location.placeName,
      lat: coords.lat,
      lng: coords.lng,
      address: coords.address,
      status: 'success',
      method: method
    };
  } else {
    await db.query(
      `UPDATE locations 
       SET geocode_status = 'failed', geocoded_at = NOW()
       WHERE id = ?`,
      [location.id]
    );
    
    console.log(`âŒ ì‹¤íŒ¨: ${location.placeName}`);
    
    return null;
  }
}

// GET /api/locations - ëª¨ë“  ì§€ì—­ ë°ì´í„° ë°˜í™˜
router.get('/', async (req, res) => {
  try {
    // 1. ì´ë¯¸ ì²˜ë¦¬ëœ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    const processedLocations = await db.query(
      `SELECT id, placeName as name, latitude as lat, longitude as lng, address
       FROM locations 
       WHERE geocode_status = 'success' AND latitude IS NOT NULL`
    );
    
    // 2. ë¯¸ì²˜ë¦¬ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ìµœëŒ€ 20ê°œì”©)
    const unprocessedLocations = await db.query(
      `SELECT * FROM locations 
       WHERE geocode_status = 'pending' 
       LIMIT 20`
    );
    
    // 3. ë¯¸ì²˜ë¦¬ ë°ì´í„° ì²˜ë¦¬ (ë³‘ë ¬ ì²˜ë¦¬)
    const newlyProcessed = await Promise.all(
      unprocessedLocations.map(loc => processLocation(loc))
    );
    
    // 4. null ì œê±° ë° í•©ì¹˜ê¸°
    const validNewlyProcessed = newlyProcessed.filter(loc => loc !== null);
    const allLocations = [...processedLocations, ...validNewlyProcessed];
    
    res.json({
      success: true,
      total: allLocations.length,
      data: allLocations
    });
    
  } catch (error) {
    console.error('API Error:', error);
    res.status(500).json({
      success: false,
      error: error.message
    });
  }
});

// GET /api/locations/stats - ì²˜ë¦¬ í˜„í™© í†µê³„
router.get('/stats', async (req, res) => {
  try {
    const stats = await db.query(`
      SELECT 
        geocode_status,
        COUNT(*) as count
      FROM locations
      GROUP BY geocode_status
    `);
    
    res.json({ success: true, stats });
  } catch (error) {
    res.status(500).json({ success: false, error: error.message });
  }
});

module.exports = router;
```

#### 2-4. ì„œë²„ ë©”ì¸ íŒŒì¼ ìˆ˜ì •

**íŒŒì¼: `server.js` ë˜ëŠ” `app.js`**
```javascript
require('dotenv').config();
const express = require('express');
const locationsRouter = require('./routes/locations');

const app = express();

app.use(express.json());
app.use('/api/locations', locationsRouter);

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
  console.log(`ğŸš€ ì„œë²„ ì‹¤í–‰ ì¤‘: http://localhost:${PORT}`);
});
```

#### ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] í™˜ê²½ ë³€ìˆ˜ ì„¤ì • ì™„ë£Œ
- [ ] ì¹´ì¹´ì˜¤ API í‚¤ ë°œê¸‰ ë° í…ŒìŠ¤íŠ¸
- [ ] Claude API í‚¤ ë°œê¸‰ ë° í…ŒìŠ¤íŠ¸
- [ ] ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ì‘ì„± ì™„ë£Œ
- [ ] API ì—”ë“œí¬ì¸íŠ¸ ì‘ì„± ì™„ë£Œ
- [ ] Postman/curlë¡œ API í…ŒìŠ¤íŠ¸

**í…ŒìŠ¤íŠ¸ ëª…ë ¹ì–´:**
```bash
curl http://localhost:3000/api/locations
curl http://localhost:3000/api/locations/stats
```

---

### **Phase 3: í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™** (1ì¼)

#### 3-1. React ì»´í¬ë„ŒíŠ¸ ìˆ˜ì •

**íŒŒì¼: `components/KakaoMap.jsx`**
```javascript
import React, { useEffect, useState } from 'react';

function KakaoMap() {
  const [locations, setLocations] = useState([]);
  const [loading, setLoading] = useState(true);
  const [stats, setStats] = useState(null);

  useEffect(() => {
    loadKakaoMap();
  }, []);

  async function loadKakaoMap() {
    try {
      // ì¹´ì¹´ì˜¤ë§µ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ
      const script = document.createElement('script');
      script.src = `//dapi.kakao.com/v2/maps/sdk.js?appkey=YOUR_JAVASCRIPT_KEY&autoload=false`;
      script.async = true;
      document.head.appendChild(script);

      script.onload = async () => {
        window.kakao.maps.load(async () => {
          // ì§€ë„ ìƒì„±
          const container = document.getElementById('map');
          const options = {
            center: new window.kakao.maps.LatLng(37.5665, 126.9780), // ì„œìš¸ ì¤‘ì‹¬
            level: 8
          };
          const map = new window.kakao.maps.Map(container, options);

          // ë°±ì—”ë“œì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
          const response = await fetch('/api/locations');
          const result = await response.json();

          if (result.success) {
            setLocations(result.data);

            // ë§ˆì»¤ í‘œì‹œ
            result.data.forEach(location => {
              const markerPosition = new window.kakao.maps.LatLng(
                location.lat, 
                location.lng
              );

              const marker = new window.kakao.maps.Marker({
                position: markerPosition,
                map: map
              });

              // ì¸í¬ìœˆë„ìš°
              const infowindow = new window.kakao.maps.InfoWindow({
                content: `<div style="padding:5px;">${location.name}</div>`
              });

              window.kakao.maps.event.addListener(marker, 'click', () => {
                infowindow.open(map, marker);
              });
            });

            console.log(`âœ… ${result.data.length}ê°œ ì§€ì—­ í‘œì‹œ ì™„ë£Œ`);
          }

          setLoading(false);
        });
      };

      // í†µê³„ ê°€ì ¸ì˜¤ê¸°
      const statsResponse = await fetch('/api/locations/stats');
      const statsResult = await statsResponse.json();
      if (statsResult.success) {
        setStats(statsResult.stats);
      }

    } catch (error) {
      console.error('ì§€ë„ ë¡œë“œ ì—ëŸ¬:', error);
      setLoading(false);
    }
  }

  return (
    <div>
      <div style={{ marginBottom: '10px' }}>
        {loading && <p>â³ ì§€ë„ ë¡œë”© ì¤‘...</p>}
        {stats && (
          <div>
            {stats.map(s => (
              <span key={s.geocode_status} style={{ marginRight: '15px' }}>
                {s.geocode_status}: {s.count}ê°œ
              </span>
            ))}
          </div>
        )}
      </div>
      <div id="map" style={{ width: '100%', height: '600px' }}></div>
    </div>
  );
}

export default KakaoMap;
```

#### 3-2. Vue.js ë²„ì „ (ì°¸ê³ ìš©)

**íŒŒì¼: `components/KakaoMap.vue`**
```vue
<template>
  <div>
    <div v-if="loading">â³ ì§€ë„ ë¡œë”© ì¤‘...</div>
    <div v-if="stats" style="margin-bottom: 10px;">
      <span v-for="s in stats" :key="s.geocode_status" style="margin-right: 15px;">
        {{ s.geocode_status }}: {{ s.count }}ê°œ
      </span>
    </div>
    <div id="map" style="width: 100%; height: 600px;"></div>
  </div>
</template>

<script>
export default {
  data() {
    return {
      locations: [],
      loading: true,
      stats: null
    };
  },
  mounted() {
    this.loadKakaoMap();
  },
  methods: {
    async loadKakaoMap() {
      const script = document.createElement('script');
      script.src = `//dapi.kakao.com/v2/maps/sdk.js?appkey=YOUR_JAVASCRIPT_KEY&autoload=false`;
      script.async = true;
      document.head.appendChild(script);

      script.onload = async () => {
        window.kakao.maps.load(async () => {
          const container = document.getElementById('map');
          const options = {
            center: new window.kakao.maps.LatLng(37.5665, 126.9780),
            level: 8
          };
          const map = new window.kakao.maps.Map(container, options);

          const response = await fetch('/api/locations');
          const result = await response.json();

          if (result.success) {
            this.locations = result.data;

            result.data.forEach(location => {
              const markerPosition = new window.kakao.maps.LatLng(
                location.lat,
                location.lng
              );

              const marker = new window.kakao.maps.Marker({
                position: markerPosition,
                map: map
              });

              const infowindow = new window.kakao.maps.InfoWindow({
                content: `<div style="padding:5px;">${location.name}</div>`
              });

              window.kakao.maps.event.addListener(marker, 'click', () => {
                infowindow.open(map, marker);
              });
            });
          }

          this.loading = false;
        });
      };

      const statsResponse = await fetch('/api/locations/stats');
      const statsResult = await statsResponse.json();
      if (statsResult.success) {
        this.stats = statsResult.stats;
      }
    }
  }
};
</script>
```

#### ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ì¹´ì¹´ì˜¤ JavaScript í‚¤ ë°œê¸‰
- [ ] í”„ë¡ íŠ¸ì—”ë“œ ì»´í¬ë„ŒíŠ¸ ì‘ì„±
- [ ] API ì—°ë™ í…ŒìŠ¤íŠ¸
- [ ] ë§ˆì»¤ í‘œì‹œ í™•ì¸

---

### **Phase 4: ë°°ì¹˜ ì²˜ë¦¬ ìŠ¤í¬ë¦½íŠ¸** (1ì¼)

#### 4-1. ì¼ê´„ ì²˜ë¦¬ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±

**íŒŒì¼: `scripts/batchGeocode.js`**
```javascript
require('dotenv').config();
const db = require('../db');
const { tryKakaoGeocode, aiCorrectAddress, preprocessQuery } = require('../utils/geocode');

async function batchProcess() {
  console.log('ğŸš€ ë°°ì¹˜ ì²˜ë¦¬ ì‹œì‘...\n');
  
  // ë¯¸ì²˜ë¦¬ ë°ì´í„° ì „ì²´ ê°€ì ¸ì˜¤ê¸°
  const unprocessed = await db.query(
    `SELECT * FROM locations 
     WHERE geocode_status = 'pending' OR latitude IS NULL`
  );
  
  console.log(`ğŸ“Š ì²˜ë¦¬í•  ë°ì´í„°: ${unprocessed.length}ê°œ\n`);
  
  let successCount = 0;
  let failCount = 0;
  let aiUsedCount = 0;
  
  for (let i = 0; i < unprocessed.length; i++) {
    const loc = unprocessed[i];
    console.log(`[${i + 1}/${unprocessed.length}] ì²˜ë¦¬ ì¤‘: ${loc.placeName}`);
    
    let coords = null;
    let method = '';
    
    // 1. ì£¼ì†Œë¡œ ì‹œë„
    if (loc.address) {
      coords = await tryKakaoGeocode(preprocessQuery(loc.address));
      if (coords) method = 'address';
    }
    
    // 2. ì¥ì†Œëª…ìœ¼ë¡œ ì‹œë„
    if (!coords && loc.placeName) {
      coords = await tryKakaoGeocode(preprocessQuery(loc.placeName));
      if (coords) method = 'placeName';
    }
    
    // 3. AI ë³´ì •
    if (!coords) {
      aiUsedCount++;
      const corrected = await aiCorrectAddress(loc);
      if (corrected) {
        coords = await tryKakaoGeocode(corrected);
        if (coords) method = 'ai';
      }
    }
    
    // ê²°ê³¼ ì €ì¥
    if (coords) {
      await db.query(
        `UPDATE locations 
         SET latitude = ?, longitude = ?, geocode_status = 'success', geocoded_at = NOW()
         WHERE id = ?`,
        [coords.lat, coords.lng, loc.id]
      );
      successCount++;
      console.log(`  âœ… ì„±ê³µ (${method}): (${coords.lat}, ${coords.lng})`);
    } else {
      await db.query(
        `UPDATE locations 
         SET geocode_status = 'failed', geocoded_at = NOW()
         WHERE id = ?`,
        [loc.id]
      );
      failCount++;
      console.log(`  âŒ ì‹¤íŒ¨`);
    }
    
    // API í˜¸ì¶œ ì œí•œ ë°©ì§€ (100ms ëŒ€ê¸°)
    await new Promise(resolve => setTimeout(resolve, 100));
  }
  
  console.log('\nğŸ“Š ì²˜ë¦¬ ì™„ë£Œ í†µê³„:');
  console.log(`  - ì„±ê³µ: ${successCount}ê°œ`);
  console.log(`  - ì‹¤íŒ¨: ${failCount}ê°œ`);
  console.log(`  - AI ì‚¬ìš©: ${aiUsedCount}ê°œ`);
  console.log(`  - ì„±ê³µë¥ : ${((successCount / unprocessed.length) * 100).toFixed(1)}%`);
  
  process.exit(0);
}

batchProcess().catch(err => {
  console.error('ë°°ì¹˜ ì²˜ë¦¬ ì—ëŸ¬:', err);
  process.exit(1);
});
```

#### 4-2. ì‹¤í–‰ ë°©ë²•

```bash
# ìˆ˜ë™ ì‹¤í–‰
node scripts/batchGeocode.js

# ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰ (ë¦¬ëˆ…ìŠ¤)
nohup node scripts/batchGeocode.js > batch.log 2>&1 &
```

#### 4-3. ìë™ ìŠ¤ì¼€ì¤„ë§ (ì„ íƒì‚¬í•­)

**Cron ì„¤ì • (ë§¤ì¼ ìƒˆë²½ 2ì‹œ ì‹¤í–‰)**
```bash
crontab -e
```

```cron
0 2 * * * cd /path/to/project && node scripts/batchGeocode.js >> /var/log/batch.log 2>&1
```

**ë˜ëŠ” PM2 ì‚¬ìš©**
```bash
npm install -g pm2
pm2 start scripts/batchGeocode.js --cron "0 2 * * *"
```

#### ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ë°°ì¹˜ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„± ì™„ë£Œ
- [ ] ì†ŒëŸ‰ ë°ì´í„°ë¡œ í…ŒìŠ¤íŠ¸ (10ê°œ)
- [ ] ì „ì²´ ë°ì´í„° ì²˜ë¦¬ ì‹¤í–‰
- [ ] ë¡œê·¸ í™•ì¸
- [ ] ìŠ¤ì¼€ì¤„ëŸ¬ ì„¤ì • (ì„ íƒ)

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê³„íš

### í…ŒìŠ¤íŠ¸ 1: API ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

```bash
# 1. í†µê³„ í™•ì¸
curl http://localhost:3000/api/locations/stats

# 2. ë°ì´í„° ì¡°íšŒ
curl http://localhost:3000/api/locations | jq '.'

# 3. íŠ¹ì • ê°œìˆ˜ë§Œ í™•ì¸
curl http://localhost:3000/api/locations | jq '.data | length'
```

### í…ŒìŠ¤íŠ¸ 2: ì¹´ì¹´ì˜¤ API ì§ì ‘ í…ŒìŠ¤íŠ¸

```javascript
// test/kakaoTest.js
const { tryKakaoGeocode } = require('../utils/geocode');

async function test() {
  // ì •ìƒ ì£¼ì†Œ
  console.log('1. ì •ìƒ ì£¼ì†Œ:', await tryKakaoGeocode('ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 152'));
  
  // ì¥ì†Œëª…
  console.log('2. ì¥ì†Œëª…:', await tryKakaoGeocode('ì„œìš¸ì—­'));
  
  // ì‹¤íŒ¨ ì¼€ì´ìŠ¤
  console.log('3. ì‹¤íŒ¨ ì¼€ì´ìŠ¤:', await tryKakaoGeocode('ì•Œìˆ˜ì—†ëŠ”ì¥ì†Œ123'));
}

test();
```

### í…ŒìŠ¤íŠ¸ 3: AI ë³´ì • í…ŒìŠ¤íŠ¸

```javascript
// test/aiTest.js
const { aiCorrectAddress } = require('../utils/geocode');

async function test() {
  const testCases = [
    { placeName: 'ê°•ë‚¨êµ¬ì²­', regionName: 'ì„œìš¸', address: '' },
    { placeName: '63ë¹Œë”©', regionName: '', address: '' },
    { placeName: 'ì´íƒœì›', regionName: 'ìš©ì‚°êµ¬', address: '' }
  ];
  
  for (const testCase of testCases) {
    const result = await aiCorrectAddress(testCase);
    console.log(`ì…ë ¥: ${testCase.placeName} â†’ AI ê²°ê³¼: ${result}`);
  }
}

test();
```

### í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸
- [ ] ì¹´ì¹´ì˜¤ API í‚¤ ì •ìƒ ì‘ë™ í™•ì¸
- [ ] AI API í‚¤ ì •ìƒ ì‘ë™ í™•ì¸
- [ ] ì •ìƒ ì£¼ì†Œ ë³€í™˜ ì„±ê³µ
- [ ] ì¥ì†Œëª… ë³€í™˜ ì„±ê³µ
- [ ] AI ë³´ì • ê¸°ëŠ¥ ì‘ë™
- [ ] DB ì €ì¥ í™•ì¸
- [ ] ì¤‘ë³µ ì²˜ë¦¬ ë°©ì§€ í™•ì¸

---

## ğŸ“ˆ ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…

### ë¡œê¹… ì „ëµ

```javascript
// utils/logger.js
const fs = require('fs');
const path = require('path');

function log(level, message, data = {}) {
  const timestamp = new Date().toISOString();
  const logEntry = {
    timestamp,
    level,
    message,
    ...data
  };
  
  // ì½˜ì†” ì¶œë ¥
  console.log(`[${timestamp}] ${level}: ${message}`, data);
  
  // íŒŒì¼ ì €ì¥
  const logFile = path.join(__dirname, '../logs', `${level}.log`);
  fs.appendFileSync(logFile, JSON.stringify(logEntry) + '\n');
}

module.exports = {
  info: (msg, data) => log('INFO', msg, data),
  error: (msg, data) => log('ERROR', msg, data),
  success: (msg, data) => log('SUCCESS', msg, data)
};
```

### ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

```javascript
// routes/locations.jsì— ì¶”ê°€
const startTime = Date.now();

// ... ì²˜ë¦¬ ë¡œì§ ...

const processingTime = Date.now() - startTime;
console.log(`â±ï¸ ì²˜ë¦¬ ì‹œê°„: ${processingTime}ms`);
```

### ëŒ€ì‹œë³´ë“œ API ì¶”ê°€

```javascript
// routes/locations.js
router.get('/dashboard', async (req, res) => {
  const stats = await db.query(`
    SELECT 
      COUNT(*) as total,
      SUM(CASE WHEN geocode_status = 'success' THEN 1 ELSE 0 END) as success,
      SUM(CASE WHEN geocode_status = 'failed' THEN 1 ELSE 0 END) as failed,
      SUM(CASE WHEN geocode_status = 'pending' THEN 1 ELSE 0 END) as pending,
      AVG(CASE WHEN latitude IS NOT NULL THEN 1 ELSE 0 END) * 100 as success_rate
    FROM locations
  `);
  
  res.json(stats[0]);
});
```

---

## ğŸ’° ë¹„ìš© ì˜ˆì¸¡ ë° ìµœì í™”

### AI API ë¹„ìš© ê³„ì‚°

**Claude API ê°€ê²©** (2025ë…„ ê¸°ì¤€)
- Input: $3.00 / 1M tokens
- Output: $15.00 / 1M tokens

**ì˜ˆìƒ ì‚¬ìš©ëŸ‰ (1ê±´ë‹¹)**
- Input: ~200 tokens
- Output: ~50 tokens
- ë¹„ìš©: ~$0.0009 (ì•½ 1.2ì›)

**ì „ì²´ ë¹„ìš© ì˜ˆì¸¡**
```
ì´ ë°ì´í„°: 10,000ê°œ
ì¹´ì¹´ì˜¤ API ì„±ê³µë¥ : 85% â†’ 8,500ê°œ ì„±ê³µ
AI ì‚¬ìš©: 1,500ê°œ (15%)

AI ë¹„ìš©: 1,500 Ã— 1.2ì› = 1,800ì›
```

### ë¹„ìš© ì ˆê° íŒ

1. **ë°°ì¹˜ í¬ê¸° ì¡°ì ˆ**: í•œ ë²ˆì— 20ê°œì”©ë§Œ ì²˜ë¦¬
2. **ìºì‹± í™œìš©**: ì„±ê³µí•œ ê²°ê³¼ëŠ” ì˜êµ¬ ì €ì¥
3. **ì¬ì‹œë„ ì œí•œ**: AI ì‹¤íŒ¨ ì‹œ ë” ì´ìƒ ì¬ì‹œë„ ì•ˆ í•¨

---

## ğŸš¨ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë¬¸ì œ 1: ì¹´ì¹´ì˜¤ API Quota ì´ˆê³¼

**ì¦ìƒ**: `429 Too Many Requests` ì—ëŸ¬

**í•´ê²°ì±…**:
```javascript
// ìš”ì²­ ê°„ ë”œë ˆì´ ì¶”ê°€
async function tryKakaoGeocodeWithRetry(query, retries = 3) {
  for (let i = 0; i < retries; i++) {
    try {
      const result = await tryKakaoGeocode(query);
      return result;
    } catch (err) {
      if (err.status === 429 && i < retries - 1) {
        await new Promise(r => setTimeout(r, 1000 * (i + 1))); // 1ì´ˆ, 2ì´ˆ, 3ì´ˆ ëŒ€ê¸°
        continue;
      }
      throw err;
    }
  }
}
```

### ë¬¸ì œ 2: AIê°€ ì˜ëª»ëœ ì£¼ì†Œ ë°˜í™˜

**ì¦ìƒ**: AIê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì£¼ì†Œë¥¼ ìƒì„±

**í•´ê²°ì±…**:
```javascript
// AI ê²°ê³¼ ê²€ì¦
async function validateAndCorrect(location) {
  const aiResult = await aiCorrectAddress(location);
  const coords = await tryKakaoGeocode(aiResult);
  
  if (!coords) {
    // AI ê²°ê³¼ê°€ ì¹´ì¹´ì˜¤ì—ì„œ ê²€ìƒ‰ë˜ì§€ ì•Šìœ¼ë©´ ì‹¤íŒ¨ ì²˜ë¦¬
    return null;
  }
  
  return coords;
}
```

### ë¬¸ì œ 3: DB ì—°ê²° íƒ€ì„ì•„ì›ƒ

**ì¦ìƒ**: ëŒ€ëŸ‰ ì²˜ë¦¬ ì‹œ DB ì—°ê²° ëŠê¹€

**í•´ê²°ì±…**:
```javascript
// ì—°ê²° í’€ ì„¤ì •
const mysql = require('mysql2/promise');

const pool = mysql.createPool({
  host: process.env.DB_HOST,
  user: process.env.DB_USER,
  password: process.env.DB_PASSWORD,
  database: process.env.DB_NAME,
  waitForConnections: true,
  connectionLimit: 10,
  queueLimit: 0
});
```

---

## âœ… ìµœì¢… ì²´í¬ë¦¬ìŠ¤íŠ¸

### Phase 1 ì™„ë£Œ í™•ì¸
- [ ] DB ìŠ¤í‚¤ë§ˆ ìˆ˜ì • ì™„ë£Œ
- [ ] ë°±ì—… ì™„ë£Œ

### Phase 2 ì™„ë£Œ í™•ì¸
- [ ] í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
- [ ] API í‚¤ ë°œê¸‰ ë° í…ŒìŠ¤íŠ¸
- [ ] ë°±ì—”ë“œ API êµ¬í˜„ ì™„ë£Œ
- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ í†µê³¼

### Phase 3 ì™„ë£Œ í™•ì¸
- [ ] í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™ ì™„ë£Œ
- [ ] ì§€ë„ì— ë§ˆì»¤ ì •ìƒ í‘œì‹œ
- [ ] UI/UX í™•ì¸

### Phase 4 ì™„ë£Œ í™•ì¸
- [ ] ë°°ì¹˜ ìŠ¤í¬ë¦½íŠ¸ ì‘ë™ í™•ì¸
- [ ] ì „ì²´ ë°ì´í„° ì²˜ë¦¬ ì™„ë£Œ
- [ ] ì„±ê³µë¥  95% ì´ìƒ ë‹¬ì„±

### ìš´ì˜ ì¤€ë¹„
- [ ] ëª¨ë‹ˆí„°ë§ ì„¤ì •
- [ ] ë¡œê¹… ì‹œìŠ¤í…œ êµ¬ì¶•
- [ ] ì—ëŸ¬ ì•Œë¦¼ ì„¤ì •
- [ ] ë¬¸ì„œí™” ì™„ë£Œ

---

## ğŸ“š ì°¸ê³  ìë£Œ

### API ë¬¸ì„œ
- [ì¹´ì¹´ì˜¤ë§µ API ê°€ì´ë“œ](https://apis.map.kakao.com/web/guide/)
- [Claude API ë¬¸ì„œ](https://docs.anthropic.com/claude/reference/getting-started-with-the-api)

### ì£¼ìš” ë§í¬
- ì¹´ì¹´ì˜¤ ê°œë°œì ì„¼í„°: https://developers.kakao.com/
- Anthropic Console: https://console.anthropic.com/

---

## ğŸ¯ ì˜ˆìƒ ê²°ê³¼

| ì§€í‘œ | ê°œì„  ì „ | ê°œì„  í›„ |
|------|---------|---------|
| ì¢Œí‘œ ë³€í™˜ ì„±ê³µë¥  | 60-70% | **95% ì´ìƒ** |
| í‰ê·  ì‘ë‹µ ì‹œê°„ | 5-10ì´ˆ | **2ì´ˆ ì´ë‚´** |
| ì¬ì²˜ë¦¬ ë¹ˆë„ | ë§¤ë²ˆ | **ìµœì´ˆ 1íšŒë§Œ** |
| AI ë¹„ìš© (1ë§Œê±´) | - | **ì•½ 2,000ì›** |
| ê°œë°œ ê¸°ê°„ | - | **5-7ì¼** |

---

## ğŸ“ ì§€ì› ë° ë¬¸ì˜

í”„ë¡œì íŠ¸ ì§„í–‰ ì¤‘ ë¬¸ì œê°€ ë°œìƒí•˜ë©´:
1. ë¡œê·¸ íŒŒì¼ í™•ì¸ (`logs/` ë””ë ‰í† ë¦¬)
2. API ì‘ë‹µ ìƒíƒœ ì½”ë“œ í™•ì¸
3. DB ì¿¼ë¦¬ ì‹¤í–‰ ì—¬ë¶€ í™•ì¸

**ì„±ê³µì„ ê¸°ì›í•©ë‹ˆë‹¤! ğŸš€**